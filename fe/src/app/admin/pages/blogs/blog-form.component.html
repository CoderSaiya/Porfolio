<div class="blog-form">
    <div class="page-header">
        <h1>{{ isEdit ? 'Chỉnh Sửa' : 'Tạo Mới' }} <span class="accent">Bài Viết</span></h1>
    </div>

    <form [formGroup]="form" (ngSubmit)="onSubmit()" class="form-card card">
        <div class="error-banner" *ngIf="error">
            <lucide-icon name="AlertCircle"></lucide-icon>
            {{ error }}
        </div>

        <div class="form-section">
            <h2>Thông Tin Cơ Bản</h2>

            <div class="form-row">
                <div class="form-group">
                    <label for="title">Tiêu Đề *</label>
                    <input id="title" type="text" formControlName="title" (blur)="generateSlug()" />
                </div>

                <div class="form-group">
                    <label for="slug">Slug *</label>
                    <input id="slug" type="text" formControlName="slug" />
                </div>
            </div>

            <div class="form-group">
                <label for="summary">Tóm Tắt *</label>
                <textarea id="summary" formControlName="summary" rows="3"></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="categoryId">Danh Mục</label>
                    <select id="categoryId" formControlName="categoryId">
                        <option value="">-- Chọn danh mục --</option>
                        <option *ngFor="let cat of categories" [value]="cat.id">{{ cat.name }}</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="featuredImage">Ảnh Đại Diện (URL)</label>
                    <input id="featuredImage" type="text" formControlName="featuredImage" placeholder="https://..." />
                </div>
            </div>

            <div class="form-group checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" formControlName="published" />
                    <span>Xuất Bản Ngay</span>
                </label>
            </div>
        </div>

        <div class="form-section">
            <h2>Nội Dung *</h2>
            <div class="form-group">
                <label for="content">Nội dung (Markdown/HTML)</label>
                <textarea id="content" formControlName="content"></textarea>
            </div>
        </div>

        <div class="form-section">
            <div class="section-header">
                <h2>Tags</h2>
                <button type="button" (click)="addTag()" class="btn btn--sm btn--outline">
                    <lucide-icon name="Plus"></lucide-icon>
                    Thêm Tag
                </button>
            </div>

            <div class="dynamic-list" formArrayName="tags">
                <div class="dynamic-item" *ngFor="let tag of tags.controls; let i = index">
                    <input type="text" [formControlName]="i" placeholder="Ví dụ: Angular, .NET" />
                    <button type="button" (click)="removeTag(i)" class="btn btn--icon btn--ghost btn--danger">
                        <lucide-icon [img]="XIcon"></lucide-icon>
                    </button>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button type="button" routerLink="/admin/blogs" class="btn btn--outline">Hủy</button>
            <button type="submit" class="btn btn--primary" [disabled]="form.invalid || loading">
                <lucide-icon [img]="SaveIcon" *ngIf="!loading"></lucide-icon>
                <span *ngIf="!loading">{{ isEdit ? 'Cập Nhật' : 'Tạo Mới' }}</span>
                <span *ngIf="loading" class="spinner"></span>
            </button>
        </div>
    </form>
</div>